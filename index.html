<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŽ® Stock Options Arcade ðŸš€</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @keyframes backgroundScroll {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes neonGlow {
            0%, 100% { box-shadow: 0 0 5px #ff00ff, 0 0 10px #ff00ff, 0 0 20px #ff00ff, 0 0 40px #ff00ff; }
            50% { box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff, 0 0 30px #00ffff, 0 0 50px #00ffff; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(45deg, #1a0033, #330066, #660099, #9900cc);
            background-size: 400% 400%;
            animation: backgroundScroll 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(255, 0, 255, 0.03) 2px, rgba(255, 0, 255, 0.03) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0, 255, 255, 0.03) 2px, rgba(0, 255, 255, 0.03) 4px);
            pointer-events: none;
            z-index: 1;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.85);
            border-radius: 20px;
            padding: 40px;
            box-shadow:
                0 0 20px rgba(255, 0, 255, 0.5),
                0 0 40px rgba(0, 255, 255, 0.3),
                inset 0 0 60px rgba(255, 0, 255, 0.1);
            border: 3px solid #ff00ff;
            position: relative;
            z-index: 2;
        }

        h1 {
            text-align: center;
            color: #00ffff;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-family: 'Press Start 2P', cursive;
            text-shadow:
                0 0 10px #00ffff,
                0 0 20px #00ffff,
                0 0 30px #00ffff,
                0 0 40px #ff00ff,
                0 0 70px #ff00ff;
            animation: float 3s ease-in-out infinite;
        }

        .subtitle {
            text-align: center;
            color: #ffff00;
            margin-bottom: 30px;
            font-size: 0.9em;
            text-shadow: 0 0 10px #ffff00;
            font-family: 'Press Start 2P', cursive;
            font-size: 0.7em;
        }

        .tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            border-bottom: none;
            justify-content: center;
        }

        .tab {
            padding: 15px 30px;
            background: linear-gradient(45deg, #ff00ff, #00ffff);
            border: 3px solid #ffff00;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.8em;
            font-weight: 700;
            font-family: 'Press Start 2P', cursive;
            color: #000;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 5px 15px rgba(255, 0, 255, 0.4);
        }

        .tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(255, 0, 255, 0.6);
            animation: neonGlow 1.5s infinite;
        }

        .tab.active {
            background: linear-gradient(45deg, #ffff00, #ff00ff);
            border-color: #00ffff;
            animation: pulse 2s infinite;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #00ffff;
            font-size: 0.9em;
            text-shadow: 0 0 5px #00ffff;
            text-transform: uppercase;
        }

        input[type="number"], input[type="text"], input[type="date"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff00ff;
            border-radius: 8px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.5);
            color: #00ffff;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        input[type="number"]:focus, input[type="text"]:focus, input[type="date"]:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            background: rgba(0, 0, 0, 0.7);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(45deg, #ff00ff, #00ffff, #ffff00);
            background-size: 200% 200%;
            animation: backgroundScroll 3s ease infinite;
            color: #000;
            border: 3px solid #ffff00;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 700;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 5px 20px rgba(255, 0, 255, 0.5);
        }

        .button:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 0, 255, 0.8);
            animation: neonGlow 1s infinite, backgroundScroll 1s ease infinite;
        }

        .results {
            margin-top: 30px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            border: 2px solid #ff00ff;
            box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
            display: none;
        }

        .results.show {
            display: block;
            animation: pulse 0.5s;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
            background: rgba(255, 0, 255, 0.1);
            margin-bottom: 10px;
            border-radius: 8px;
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            font-weight: 600;
            color: #ffff00;
            text-shadow: 0 0 5px #ffff00;
        }

        .result-value {
            font-weight: 700;
            color: #00ffff;
            font-size: 1.2em;
            text-shadow: 0 0 10px #00ffff;
        }

        .result-value.positive {
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }

        .result-value.negative {
            color: #ff0000;
            text-shadow: 0 0 10px #ff0000;
        }

        .vesting-info {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            border-left: 4px solid #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }

        .scenarios {
            margin-top: 20px;
        }

        .scenario-title {
            font-weight: 700;
            color: #ff00ff;
            margin-bottom: 10px;
            font-size: 1.1em;
            text-shadow: 0 0 10px #ff00ff;
        }

        .scenario-item {
            padding: 10px;
            margin-bottom: 8px;
            background: rgba(255, 0, 255, 0.1);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            border: 1px solid rgba(255, 0, 255, 0.3);
        }

        .help-text {
            font-size: 0.75em;
            color: #999;
            margin-top: 4px;
            font-style: italic;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ff00ff;
            border-radius: 8px;
            font-size: 1em;
            background: rgba(0, 0, 0, 0.5);
            color: #00ffff;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Courier New', monospace;
        }

        select:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }

        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.6);
            border-radius: 12px;
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        .chart-container h3 {
            color: #ffff00;
            text-shadow: 0 0 10px #ffff00;
        }

        canvas {
            max-height: 400px;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.2em;
            }

            .subtitle {
                font-size: 0.5em;
            }

            .tabs {
                overflow-x: auto;
                flex-direction: column;
            }

            .tab {
                white-space: nowrap;
                font-size: 0.6em;
                padding: 10px 15px;
            }

            .button {
                font-size: 0.7em;
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ’° OPTIONS ARCADE ðŸš€</h1>
        <p class="subtitle">LEVEL UP YOUR EQUITY GAME</p>

        <div class="tabs">
            <button class="tab active" onclick="switchTab('simple')">ðŸŽ¯ Quick Play</button>
            <button class="tab" onclick="switchTab('vesting')">ðŸ“ˆ Timeline Mode</button>
        </div>

        <div id="simple-tab" class="tab-content active">
        <form id="calculator-form">
            <div class="form-group">
                <label for="numOptions">Number of Options Granted</label>
                <input type="number" id="numOptions" min="0" step="1" value="10000" required>
                <div class="help-text">Total number of stock options you've been granted</div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="strikePrice">Strike Price ($)</label>
                    <input type="number" id="strikePrice" min="0" step="0.01" value="10" required>
                    <div class="help-text">Exercise price per share</div>
                </div>

                <div class="form-group">
                    <label for="currentPrice">Current Stock Price ($)</label>
                    <input type="number" id="currentPrice" min="0" step="0.01" value="50" required>
                    <div class="help-text">Current fair market value</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestedPercentage">Vested Percentage (%)</label>
                    <input type="number" id="vestedPercentage" min="0" max="100" step="1" value="25" required>
                    <div class="help-text">Percentage currently vested</div>
                </div>

                <div class="form-group">
                    <label for="taxRate">Tax Rate (%)</label>
                    <input type="number" id="taxRate" min="0" max="100" step="0.1" value="30" required>
                    <div class="help-text">Combined federal + state tax rate</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="minExitPrice">Min Exit Price ($)</label>
                    <input type="number" id="minExitPrice" min="0" step="1" value="25">
                    <div class="help-text">Minimum price for scenario range</div>
                </div>

                <div class="form-group">
                    <label for="maxExitPrice">Max Exit Price ($)</label>
                    <input type="number" id="maxExitPrice" min="0" step="1" value="150">
                    <div class="help-text">Maximum price for scenario range</div>
                </div>
            </div>

            <button type="submit" class="button">Calculate Value</button>
        </form>

        <div id="results" class="results">
            <div class="result-item">
                <span class="result-label">Current Intrinsic Value (All Options)</span>
                <span class="result-value" id="totalValue">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Gain per Option</span>
                <span class="result-value" id="gainPerOption">$0</span>
            </div>

            <div class="vesting-info">
                <div class="result-item">
                    <span class="result-label">Vested Options</span>
                    <span class="result-value" id="vestedOptions">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Unvested Options</span>
                    <span class="result-value" id="unvestedOptions">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Current Vested Value (Before Tax)</span>
                    <span class="result-value positive" id="vestedValue">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">After-Tax Value (Vested)</span>
                    <span class="result-value positive" id="afterTaxValue">$0</span>
                </div>
            </div>

            <div id="scenariosContainer"></div>
        </div>

        <div id="simple-chart-results" class="results">
            <div class="chart-container">
                <h3 style="margin-bottom: 15px; color: #ffff00; text-shadow: 0 0 10px #ffff00; font-family: 'Press Start 2P', cursive; font-size: 0.9em;">Exit Scenario Comparison</h3>
                <canvas id="scenarioChart"></canvas>
            </div>
        </div>
        </div>

        <div id="vesting-tab" class="tab-content">
        <form id="vesting-form">
            <div class="form-group">
                <label for="vestNumOptions">Number of Options Granted</label>
                <input type="number" id="vestNumOptions" min="0" step="1" value="10000" required>
                <div class="help-text">Total number of stock options you've been granted</div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestStrikePrice">Strike Price ($)</label>
                    <input type="number" id="vestStrikePrice" min="0" step="0.01" value="10" required>
                    <div class="help-text">Exercise price per share</div>
                </div>

                <div class="form-group">
                    <label for="vestCurrentPrice">Current Stock Price ($)</label>
                    <input type="number" id="vestCurrentPrice" min="0" step="0.01" value="50" required>
                    <div class="help-text">Current fair market value</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestingPeriod">Vesting Period (years)</label>
                    <input type="number" id="vestingPeriod" min="1" max="10" step="0.5" value="4" required>
                    <div class="help-text">Total vesting duration</div>
                </div>

                <div class="form-group">
                    <label for="cliffPeriod">Cliff Period (years)</label>
                    <input type="number" id="cliffPeriod" min="0" max="5" step="0.25" value="1" required>
                    <div class="help-text">Time before first vesting</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestingFrequency">Vesting Frequency</label>
                    <select id="vestingFrequency" required>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="semi-annually">Semi-Annually</option>
                        <option value="annually">Annually</option>
                    </select>
                    <div class="help-text">How often options vest</div>
                </div>

                <div class="form-group">
                    <label for="vestTaxRate">Tax Rate (%)</label>
                    <input type="number" id="vestTaxRate" min="0" max="100" step="0.1" value="30" required>
                    <div class="help-text">Combined federal + state tax rate</div>
                </div>
            </div>

            <div class="form-group">
                <label for="grantDate">Grant Date</label>
                <input type="date" id="grantDate" required>
                <div class="help-text">When the options were granted</div>
            </div>

            <button type="submit" class="button">Generate Vesting Timeline</button>
        </form>

        <div id="vesting-results" class="results">
            <div class="chart-container">
                <h3 style="margin-bottom: 15px; color: #ffff00; text-shadow: 0 0 10px #ffff00; font-family: 'Press Start 2P', cursive; font-size: 0.9em;">Vested Options Over Time</h3>
                <canvas id="vestingOptionsChart"></canvas>
            </div>
            <div class="chart-container" style="margin-top: 20px;">
                <h3 style="margin-bottom: 15px; color: #ffff00; text-shadow: 0 0 10px #ffff00; font-family: 'Press Start 2P', cursive; font-size: 0.9em;">Value Over Time</h3>
                <canvas id="vestingValueChart"></canvas>
            </div>
        </div>
        </div>
    </div>

    <script>
        document.getElementById('calculator-form').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateOptions();
        });

        function calculateOptions() {
            const numOptions = parseFloat(document.getElementById('numOptions').value);
            const strikePrice = parseFloat(document.getElementById('strikePrice').value);
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const vestedPercentage = parseFloat(document.getElementById('vestedPercentage').value);
            const taxRate = parseFloat(document.getElementById('taxRate').value);
            const minExitPrice = parseFloat(document.getElementById('minExitPrice').value);
            const maxExitPrice = parseFloat(document.getElementById('maxExitPrice').value);

            const gainPerOption = Math.max(0, currentPrice - strikePrice);
            const totalValue = gainPerOption * numOptions;

            const vestedOptions = Math.floor(numOptions * (vestedPercentage / 100));
            const unvestedOptions = numOptions - vestedOptions;
            const vestedValue = gainPerOption * vestedOptions;
            const afterTaxValue = vestedValue * (1 - taxRate / 100);

            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            document.getElementById('gainPerOption').textContent = formatCurrency(gainPerOption);
            document.getElementById('vestedOptions').textContent = vestedOptions.toLocaleString();
            document.getElementById('unvestedOptions').textContent = unvestedOptions.toLocaleString();
            document.getElementById('vestedValue').textContent = formatCurrency(vestedValue);
            document.getElementById('afterTaxValue').textContent = formatCurrency(afterTaxValue);

            document.getElementById('gainPerOption').className = 'result-value ' + (gainPerOption > 0 ? 'positive' : 'negative');

            // Clear old scenarios container (not used anymore)
            const scenariosContainer = document.getElementById('scenariosContainer');
            scenariosContainer.textContent = '';

            // Create scenario comparison chart
            createScenarioChart(minExitPrice, maxExitPrice, strikePrice, currentPrice, vestedOptions, taxRate);

            document.getElementById('results').classList.add('show');
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        // Scenario chart
        let scenarioChart = null;

        function createScenarioChart(minExitPrice, maxExitPrice, strikePrice, currentPrice, vestedOptions, taxRate) {
            // Generate price range with reasonable intervals
            const priceRange = maxExitPrice - minExitPrice;
            const numberOfPoints = Math.min(20, Math.max(10, Math.ceil(priceRange / 5))); // 10-20 points
            const step = priceRange / (numberOfPoints - 1);

            const allPrices = [];
            for (let i = 0; i < numberOfPoints; i++) {
                allPrices.push(Math.round(minExitPrice + (step * i)));
            }

            // Make sure current price is highlighted if it's in range
            if (currentPrice >= minExitPrice && currentPrice <= maxExitPrice && !allPrices.includes(currentPrice)) {
                allPrices.push(currentPrice);
                allPrices.sort((a, b) => a - b);
            }

            const labels = allPrices.map(price => '$' + price.toFixed(0));
            const beforeTaxValues = allPrices.map(price => {
                const gain = Math.max(0, price - strikePrice);
                return gain * vestedOptions;
            });
            const afterTaxValues = beforeTaxValues.map(value => value * (1 - taxRate / 100));

            // Highlight current price
            const backgroundColors = allPrices.map(price =>
                price === currentPrice ? 'rgba(16, 185, 129, 0.9)' : 'rgba(16, 185, 129, 0.6)'
            );
            const afterTaxBackgroundColors = allPrices.map(price =>
                price === currentPrice ? 'rgba(118, 75, 162, 0.9)' : 'rgba(118, 75, 162, 0.6)'
            );

            const ctx = document.getElementById('scenarioChart').getContext('2d');

            if (scenarioChart) {
                scenarioChart.destroy();
            }

            scenarioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Before-Tax Value',
                            data: beforeTaxValues,
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderColor: '#10b981',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'After-Tax Value',
                            data: afterTaxValues,
                            backgroundColor: 'rgba(118, 75, 162, 0.2)',
                            borderColor: '#764ba2',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const price = allPrices[context.dataIndex];
                                    let label = context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    if (price === currentPrice) {
                                        label += ' (Current Price)';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Value ($)',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Stock Price per Share',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });

            // Show the chart container
            document.getElementById('simple-chart-results').classList.add('show');
        }

        // Auto-calculate on input change
        const inputs = document.querySelectorAll('#simple-tab input[type="number"]');
        inputs.forEach(input => {
            input.addEventListener('input', function() {
                if (document.getElementById('results').classList.contains('show')) {
                    calculateOptions();
                }
            });
        });

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.getElementById('simple-tab').classList.remove('active');
            document.getElementById('vesting-tab').classList.remove('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Vesting timeline calculator
        let vestingOptionsChart = null;
        let vestingValueChart = null;

        // Set default grant date to today
        document.getElementById('grantDate').valueAsDate = new Date();

        document.getElementById('vesting-form').addEventListener('submit', function(e) {
            e.preventDefault();
            calculateVestingTimeline();
        });

        function calculateVestingTimeline() {
            const numOptions = parseFloat(document.getElementById('vestNumOptions').value);
            const strikePrice = parseFloat(document.getElementById('vestStrikePrice').value);
            const currentPrice = parseFloat(document.getElementById('vestCurrentPrice').value);
            const vestingPeriod = parseFloat(document.getElementById('vestingPeriod').value);
            const cliffPeriod = parseFloat(document.getElementById('cliffPeriod').value);
            const frequency = document.getElementById('vestingFrequency').value;
            const taxRate = parseFloat(document.getElementById('vestTaxRate').value);
            const grantDate = new Date(document.getElementById('grantDate').value);

            // Calculate vesting intervals in months
            const frequencyMonths = {
                'monthly': 1,
                'quarterly': 3,
                'semi-annually': 6,
                'annually': 12
            };

            const intervalMonths = frequencyMonths[frequency];
            const totalMonths = vestingPeriod * 12;
            const cliffMonths = cliffPeriod * 12;

            // Calculate vesting schedule
            const vestingSchedule = [];
            const labels = [];
            const vestedOptions = [];
            const vestedPercentages = [];
            const vestedValues = [];
            const afterTaxValues = [];

            let currentMonth = 0;
            let totalVested = 0;

            // Before cliff
            while (currentMonth < cliffMonths) {
                const date = new Date(grantDate);
                date.setMonth(date.getMonth() + currentMonth);
                labels.push(formatDate(date));
                vestedOptions.push(0);
                vestedPercentages.push(0);
                vestedValues.push(0);
                afterTaxValues.push(0);
                currentMonth += intervalMonths;
            }

            // At cliff
            if (cliffMonths > 0) {
                const cliffVest = Math.floor(numOptions * (cliffMonths / totalMonths));
                totalVested = cliffVest;
                const date = new Date(grantDate);
                date.setMonth(date.getMonth() + cliffMonths);
                labels.push(formatDate(date));
                vestedOptions.push(totalVested);
                vestedPercentages.push((totalVested / numOptions) * 100);
                const value = totalVested * Math.max(0, currentPrice - strikePrice);
                vestedValues.push(value);
                afterTaxValues.push(value * (1 - taxRate / 100));
                currentMonth = cliffMonths + intervalMonths;
            }

            // After cliff
            while (currentMonth <= totalMonths) {
                const vestPercentage = currentMonth / totalMonths;
                totalVested = Math.min(numOptions, Math.floor(numOptions * vestPercentage));

                const date = new Date(grantDate);
                date.setMonth(date.getMonth() + currentMonth);
                labels.push(formatDate(date));
                vestedOptions.push(totalVested);
                vestedPercentages.push((totalVested / numOptions) * 100);

                const value = totalVested * Math.max(0, currentPrice - strikePrice);
                vestedValues.push(value);
                afterTaxValues.push(value * (1 - taxRate / 100));

                currentMonth += intervalMonths;
            }

            // Create first chart - Vested Options
            const optionsCtx = document.getElementById('vestingOptionsChart').getContext('2d');

            if (vestingOptionsChart) {
                vestingOptionsChart.destroy();
            }

            vestingOptionsChart = new Chart(optionsCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Vested Options',
                            data: vestedOptions,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const optionCount = vestedOptions[context.dataIndex];
                                    const percentage = vestedPercentages[context.dataIndex];
                                    return [
                                        optionCount.toLocaleString() + ' options vested',
                                        percentage.toFixed(1) + '% of total'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Number of Options',
                                color: '#667eea',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Percentage Vested',
                                color: '#10b981',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(0) + '%';
                                },
                                color: '#10b981'
                            },
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                drawOnChartArea: false,
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });

            // Create second chart - Dollar Values
            const valueCtx = document.getElementById('vestingValueChart').getContext('2d');

            if (vestingValueChart) {
                vestingValueChart.destroy();
            }

            vestingValueChart = new Chart(valueCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Before-Tax Value',
                            data: vestedValues,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        },
                        {
                            label: 'After-Tax Value',
                            data: afterTaxValues,
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            title: {
                                display: true,
                                text: 'Value ($)',
                                color: '#10b981',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            beginAtZero: true
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });

            document.getElementById('vesting-results').classList.add('show');
        }

        function formatDate(date) {
            const options = { year: 'numeric', month: 'short' };
            return date.toLocaleDateString('en-US', options);
        }
    </script>
</body>
</html>
