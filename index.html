<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Options Calculator</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“ˆ</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <style>
        /* CSS Variables for Design Tokens */
        :root {
            /* Light mode colors */
            --color-bg-base: #FFFFFF;
            --color-bg-elevated: #FAFAFA;
            --color-bg-input: #FFFFFF;
            --color-text-primary: #18181B;
            --color-text-secondary: #52525B;
            --color-text-tertiary: #A1A1AA;
            --color-border: #E4E4E7;
            --color-border-hover: #D4D4D8;
            --color-accent-primary: #0D9488;
            --color-accent-hover: #0F766E;
            --color-accent-light: #F0FDFA;
            --color-success: #16A34A;
            --color-success-light: #DCFCE7;
            --color-error: #DC2626;
            --color-error-light: #FEE2E2;
            --color-shadow: rgba(0, 0, 0, 0.1);
            --color-shadow-hover: rgba(0, 0, 0, 0.15);

            /* Typography */
            --font-family-base: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            --font-family-mono: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
            --font-size-xs: 0.75rem;
            --font-size-sm: 0.875rem;
            --font-size-base: 1rem;
            --font-size-lg: 1.125rem;
            --font-size-xl: 1.25rem;
            --font-size-2xl: 1.5rem;
            --font-size-3xl: 1.875rem;
            --font-weight-normal: 400;
            --font-weight-medium: 500;
            --font-weight-semibold: 600;
            --font-weight-bold: 700;
            --line-height-tight: 1.25;
            --line-height-normal: 1.5;
            --line-height-relaxed: 1.75;

            /* Spacing */
            --space-1: 4px;
            --space-2: 8px;
            --space-3: 12px;
            --space-4: 16px;
            --space-5: 20px;
            --space-6: 24px;
            --space-8: 32px;
            --space-10: 40px;
            --space-12: 48px;
            --space-16: 64px;

            /* Border radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;

            /* Shadows */
            --shadow-sm: 0 1px 2px 0 var(--color-shadow);
            --shadow-md: 0 4px 6px -1px var(--color-shadow);
            --shadow-lg: 0 10px 15px -3px var(--color-shadow);
            --shadow-xl: 0 20px 25px -5px var(--color-shadow);

            /* Transitions */
            --transition-fast: 150ms ease;
            --transition-base: 200ms ease;
            --transition-slow: 300ms ease;
        }

        /* Dark mode colors */
        [data-theme="dark"] {
            --color-bg-base: #09090B;
            --color-bg-elevated: #18181B;
            --color-bg-input: #27272A;
            --color-text-primary: #FAFAFA;
            --color-text-secondary: #A1A1AA;
            --color-text-tertiary: #71717A;
            --color-border: #27272A;
            --color-border-hover: #3F3F46;
            --color-accent-primary: #2DD4BF;
            --color-accent-hover: #5EEAD4;
            --color-accent-light: #134E4A;
            --color-success: #4ADE80;
            --color-success-light: #14532D;
            --color-error: #F87171;
            --color-error-light: #7F1D1D;
            --color-shadow: rgba(0, 0, 0, 0.5);
            --color-shadow-hover: rgba(0, 0, 0, 0.7);
        }

        /* Reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            *,
            *::before,
            *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Base styles */
        html {
            font-size: 16px;
        }

        body {
            font-family: var(--font-family-base);
            background: var(--color-bg-base);
            color: var(--color-text-secondary);
            line-height: var(--line-height-normal);
            min-height: 100vh;
            padding: var(--space-6);
            transition: background-color var(--transition-base), color var(--transition-base);
        }

        /* Screen reader only content */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }

        /* Skip link for accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--color-accent-primary);
            color: white;
            padding: var(--space-2) var(--space-4);
            text-decoration: none;
            border-radius: var(--radius-md);
            z-index: 100;
        }

        .skip-link:focus {
            top: var(--space-2);
            left: var(--space-2);
        }

        /* Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: var(--color-bg-elevated);
            border-radius: var(--radius-xl);
            padding: var(--space-10);
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--color-border);
            position: relative;
        }

        /* Theme toggle button */
        .theme-toggle {
            position: absolute;
            top: var(--space-4);
            right: var(--space-4);
            width: 40px;
            height: 40px;
            border-radius: var(--radius-md);
            border: 1px solid var(--color-border);
            background: var(--color-bg-base);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-base);
            font-size: var(--font-size-lg);
        }

        .theme-toggle:hover {
            background: var(--color-accent-light);
            border-color: var(--color-accent-primary);
        }

        .theme-toggle:focus-visible {
            outline: 2px solid var(--color-accent-primary);
            outline-offset: 2px;
        }

        /* Typography */
        h1 {
            text-align: center;
            color: var(--color-text-primary);
            margin-bottom: var(--space-2);
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            line-height: var(--line-height-tight);
        }

        .subtitle {
            text-align: center;
            color: var(--color-text-tertiary);
            margin-bottom: var(--space-8);
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-medium);
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: var(--space-2);
            margin-bottom: var(--space-8);
            border-bottom: 2px solid var(--color-border);
            justify-content: center;
            role: tablist;
        }

        .tab {
            padding: var(--space-3) var(--space-6);
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            cursor: pointer;
            font-size: var(--font-size-sm);
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-secondary);
            transition: all var(--transition-base);
            position: relative;
        }

        .tab:hover {
            color: var(--color-text-primary);
            background: var(--color-accent-light);
        }

        .tab:focus-visible {
            outline: 2px solid var(--color-accent-primary);
            outline-offset: 2px;
            border-radius: var(--radius-sm);
        }

        .tab.active {
            color: var(--color-accent-primary);
            border-bottom-color: var(--color-accent-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Forms */
        .form-group {
            margin-bottom: var(--space-5);
        }

        label {
            display: block;
            margin-bottom: var(--space-2);
            font-weight: var(--font-weight-medium);
            color: var(--color-text-primary);
            font-size: var(--font-size-sm);
        }

        input[type="number"],
        input[type="text"],
        input[type="date"],
        select {
            width: 100%;
            padding: var(--space-3);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            background: var(--color-bg-input);
            color: var(--color-text-primary);
            transition: all var(--transition-base);
            font-family: var(--font-family-base);
        }

        input[type="number"]:hover,
        input[type="text"]:hover,
        input[type="date"]:hover,
        select:hover {
            border-color: var(--color-border-hover);
        }

        input[type="number"]:focus-visible,
        input[type="text"]:focus-visible,
        input[type="date"]:focus-visible,
        select:focus-visible {
            outline: 2px solid var(--color-accent-primary);
            outline-offset: 2px;
            border-color: var(--color-accent-primary);
        }

        .input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: var(--space-5);
        }

        .help-text {
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
            margin-top: var(--space-1);
            font-style: normal;
        }

        select {
            cursor: pointer;
        }

        /* Button */
        .button {
            width: 100%;
            padding: var(--space-4);
            background: var(--color-accent-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: var(--font-size-base);
            font-weight: var(--font-weight-semibold);
            cursor: pointer;
            margin-top: var(--space-5);
            transition: all var(--transition-base);
            font-family: var(--font-family-base);
        }

        .button:hover {
            background: var(--color-accent-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .button:active {
            transform: translateY(0);
        }

        .button:focus-visible {
            outline: 2px solid var(--color-accent-primary);
            outline-offset: 2px;
        }

        /* Results */
        .results {
            margin-top: var(--space-8);
            padding: var(--space-6);
            background: var(--color-bg-base);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
            display: none;
        }

        .results.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-4);
            border-bottom: 1px solid var(--color-border);
            margin-bottom: var(--space-2);
        }

        .result-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .result-label {
            font-weight: var(--font-weight-medium);
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
        }

        .result-value {
            font-weight: var(--font-weight-semibold);
            color: var(--color-text-primary);
            font-size: var(--font-size-lg);
            font-family: var(--font-family-mono);
        }

        .result-value.positive {
            color: var(--color-success);
        }

        .result-value.negative {
            color: var(--color-error);
        }

        .vesting-info {
            margin-top: var(--space-4);
            padding: var(--space-4);
            background: var(--color-accent-light);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--color-accent-primary);
        }

        /* Charts */
        .chart-container {
            margin-top: var(--space-8);
            padding: var(--space-6);
            background: var(--color-bg-base);
            border-radius: var(--radius-lg);
            border: 1px solid var(--color-border);
        }

        .chart-container h3 {
            color: var(--color-text-primary);
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-semibold);
            margin-bottom: var(--space-4);
        }

        canvas {
            max-height: 400px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: var(--space-6);
            }

            .input-group {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: var(--font-size-2xl);
            }
        }

        @media (max-width: 480px) {
            body {
                padding: var(--space-3);
            }

            .container {
                padding: var(--space-4);
            }

            .tabs {
                flex-direction: column;
                border-bottom: none;
            }

            .tab {
                border-bottom: 1px solid var(--color-border);
                margin-bottom: 0;
                text-align: left;
                padding: var(--space-3);
            }

            .tab.active {
                border-left: 3px solid var(--color-accent-primary);
                border-bottom: 1px solid var(--color-border);
                background: var(--color-accent-light);
            }

            h1 {
                font-size: var(--font-size-xl);
            }

            .subtitle {
                font-size: var(--font-size-xs);
            }
        }
    </style>
</head>
<body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
        <button class="theme-toggle" aria-label="Toggle theme" aria-pressed="false" id="theme-toggle">
            <span aria-hidden="true">ðŸŒ™</span>
        </button>
        <h1>Stock Options Calculator</h1>
        <p class="subtitle">Understand the value of your equity compensation</p>

        <div class="tabs" role="tablist">
            <button class="tab active" role="tab" aria-selected="true" aria-controls="simple-tab" id="simple-tab-btn" tabindex="0" onclick="switchTab('simple', event)">Quick Calculator</button>
            <button class="tab" role="tab" aria-selected="false" aria-controls="vesting-tab" id="vesting-tab-btn" tabindex="-1" onclick="switchTab('vesting', event)">Vesting Timeline</button>
            <button class="tab" role="tab" aria-selected="false" aria-controls="rsu-tab" id="rsu-tab-btn" tabindex="-1" onclick="switchTab('rsu', event)">RSU Calculator</button>
        </div>

        <div id="simple-tab" class="tab-content active" role="tabpanel" aria-labelledby="simple-tab-btn">
        <main id="main-content">
        <form id="calculator-form">
            <div class="form-group">
                <label for="numOptions">Number of Options Granted</label>
                <input type="number" id="numOptions" min="0" step="1" value="10000" required aria-describedby="numOptions-help">
                <div class="help-text" id="numOptions-help">Total number of stock options you've been granted</div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="strikePrice">Strike Price ($)</label>
                    <input type="number" id="strikePrice" min="0" step="0.01" value="10" required aria-describedby="strikePrice-help">
                    <div class="help-text" id="strikePrice-help">Exercise price per share</div>
                </div>

                <div class="form-group">
                    <label for="currentPrice">Current Stock Price ($)</label>
                    <input type="number" id="currentPrice" min="0" step="0.01" value="50" required aria-describedby="currentPrice-help">
                    <div class="help-text" id="currentPrice-help">Current fair market value</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestedPercentage">Vested Percentage (%)</label>
                    <input type="number" id="vestedPercentage" min="0" max="100" step="1" value="25" required aria-describedby="vestedPercentage-help">
                    <div class="help-text" id="vestedPercentage-help">Percentage currently vested</div>
                </div>

                <div class="form-group">
                    <label for="taxRate">Tax Rate (%)</label>
                    <input type="number" id="taxRate" min="0" max="100" step="0.1" value="30" required aria-describedby="taxRate-help">
                    <div class="help-text" id="taxRate-help">Combined federal + state tax rate</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="minExitPrice">Min Exit Price ($)</label>
                    <input type="number" id="minExitPrice" min="0" step="1" value="25" aria-describedby="minExitPrice-help">
                    <div class="help-text" id="minExitPrice-help">Minimum price for scenario range</div>
                </div>

                <div class="form-group">
                    <label for="maxExitPrice">Max Exit Price ($)</label>
                    <input type="number" id="maxExitPrice" min="0" step="1" value="150" aria-describedby="maxExitPrice-help">
                    <div class="help-text" id="maxExitPrice-help">Maximum price for scenario range</div>
                </div>
            </div>

            <button type="submit" class="button">Calculate Value</button>
        </form>

        <div id="results" class="results" aria-live="polite">
            <div class="result-item">
                <span class="result-label">Current Intrinsic Value (All Options)</span>
                <span class="result-value" id="totalValue">$0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Gain per Option</span>
                <span class="result-value" id="gainPerOption">$0</span>
            </div>

            <div class="vesting-info">
                <div class="result-item">
                    <span class="result-label">Vested Options</span>
                    <span class="result-value" id="vestedOptions">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Unvested Options</span>
                    <span class="result-value" id="unvestedOptions">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Current Vested Value (Before Tax)</span>
                    <span class="result-value positive" id="vestedValue">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">After-Tax Value (Vested)</span>
                    <span class="result-value positive" id="afterTaxValue">$0</span>
                </div>
            </div>

            <div id="scenariosContainer"></div>
        </div>

        <div id="simple-chart-results" class="results">
            <div class="chart-container">
                <h3>Exit Scenario Comparison</h3>
                <canvas id="scenarioChart"></canvas>
            </div>
        </div>
        </main>
        </div>

        <div id="vesting-tab" class="tab-content" role="tabpanel" aria-labelledby="vesting-tab-btn">
        <form id="vesting-form">
            <div class="form-group">
                <label for="vestNumOptions">Number of Options Granted</label>
                <input type="number" id="vestNumOptions" min="0" step="1" value="10000" required aria-describedby="vestNumOptions-help">
                <div class="help-text" id="vestNumOptions-help">Total number of stock options you've been granted</div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestStrikePrice">Strike Price ($)</label>
                    <input type="number" id="vestStrikePrice" min="0" step="0.01" value="10" required aria-describedby="vestStrikePrice-help">
                    <div class="help-text" id="vestStrikePrice-help">Exercise price per share</div>
                </div>

                <div class="form-group">
                    <label for="vestCurrentPrice">Current Stock Price ($)</label>
                    <input type="number" id="vestCurrentPrice" min="0" step="0.01" value="50" required aria-describedby="vestCurrentPrice-help">
                    <div class="help-text" id="vestCurrentPrice-help">Current fair market value</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestingPeriod">Vesting Period (years)</label>
                    <input type="number" id="vestingPeriod" min="1" max="10" step="0.5" value="4" required aria-describedby="vestingPeriod-help">
                    <div class="help-text" id="vestingPeriod-help">Total vesting duration</div>
                </div>

                <div class="form-group">
                    <label for="cliffPeriod">Cliff Period (years)</label>
                    <input type="number" id="cliffPeriod" min="0" max="5" step="0.25" value="1" required aria-describedby="cliffPeriod-help">
                    <div class="help-text" id="cliffPeriod-help">Time before first vesting</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="vestingFrequency">Vesting Frequency</label>
                    <select id="vestingFrequency" required aria-describedby="vestingFrequency-help">
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="semi-annually">Semi-Annually</option>
                        <option value="annually">Annually</option>
                    </select>
                    <div class="help-text" id="vestingFrequency-help">How often options vest</div>
                </div>

                <div class="form-group">
                    <label for="vestTaxRate">Tax Rate (%)</label>
                    <input type="number" id="vestTaxRate" min="0" max="100" step="0.1" value="30" required aria-describedby="vestTaxRate-help">
                    <div class="help-text" id="vestTaxRate-help">Combined federal + state tax rate</div>
                </div>
            </div>

            <div class="form-group">
                <label for="grantDate">Grant Date</label>
                <input type="date" id="grantDate" required aria-describedby="grantDate-help">
                <div class="help-text" id="grantDate-help">When the options were granted</div>
            </div>

            <button type="submit" class="button">Generate Vesting Timeline</button>
        </form>

        <div id="vesting-results" class="results" aria-live="polite">
            <div class="chart-container">
                <h3>Vested Options Over Time</h3>
                <canvas id="vestingOptionsChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>Value Over Time</h3>
                <canvas id="vestingValueChart"></canvas>
            </div>
        </div>
        </div>

        <div id="rsu-tab" class="tab-content" role="tabpanel" aria-labelledby="rsu-tab-btn">
        <form id="rsu-form">
            <div class="form-group">
                <label for="rsuNumShares">Number of RSUs Granted</label>
                <input type="number" id="rsuNumShares" min="0" step="1" value="1000" required aria-describedby="rsuNumShares-help">
                <div class="help-text" id="rsuNumShares-help">Total number of RSUs granted to you</div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="rsuGrantPrice">Grant Price ($)</label>
                    <input type="number" id="rsuGrantPrice" min="0" step="0.01" value="100" required aria-describedby="rsuGrantPrice-help">
                    <div class="help-text" id="rsuGrantPrice-help">Stock price at grant date (for reference)</div>
                </div>

                <div class="form-group">
                    <label for="rsuCurrentPrice">Current Stock Price ($)</label>
                    <input type="number" id="rsuCurrentPrice" min="0" step="0.01" value="150" required aria-describedby="rsuCurrentPrice-help">
                    <div class="help-text" id="rsuCurrentPrice-help">Current market price per share</div>
                </div>
            </div>

            <div class="input-group">
                <div class="form-group">
                    <label for="rsuVestedPercentage">Vested Percentage (%)</label>
                    <input type="number" id="rsuVestedPercentage" min="0" max="100" step="1" value="50" required aria-describedby="rsuVestedPercentage-help">
                    <div class="help-text" id="rsuVestedPercentage-help">Percentage of RSUs that have vested</div>
                </div>

                <div class="form-group">
                    <label for="rsuTaxRate">Tax Rate (%)</label>
                    <input type="number" id="rsuTaxRate" min="0" max="100" step="0.1" value="40" required aria-describedby="rsuTaxRate-help">
                    <div class="help-text" id="rsuTaxRate-help">Combined federal + state tax rate (RSUs taxed as income)</div>
                </div>
            </div>

            <button type="submit" class="button">Calculate RSU Value</button>
        </form>

        <div id="rsu-results" class="results" aria-live="polite">
            <div class="result-item">
                <span class="result-label">Total RSUs Granted</span>
                <span class="result-value" id="rsuTotalShares">0</span>
            </div>
            <div class="result-item">
                <span class="result-label">Current Total Value</span>
                <span class="result-value" id="rsuTotalValue">$0</span>
            </div>

            <div class="vesting-info">
                <div class="result-item">
                    <span class="result-label">Vested RSUs</span>
                    <span class="result-value" id="rsuVestedShares">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Unvested RSUs</span>
                    <span class="result-value" id="rsuUnvestedShares">0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Vested Value (Before Tax)</span>
                    <span class="result-value positive" id="rsuVestedValue">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">After-Tax Value (Vested)</span>
                    <span class="result-value positive" id="rsuAfterTaxValue">$0</span>
                </div>
                <div class="result-item">
                    <span class="result-label">Gain Since Grant</span>
                    <span class="result-value" id="rsuGain">$0</span>
                </div>
            </div>
        </div>
        </div>
    </div>

    <script>
        // Theme Manager
        class ThemeManager {
            constructor() {
                this.themeToggle = document.getElementById('theme-toggle');
                this.init();
            }

            init() {
                // Check for saved theme preference or default to system preference
                const savedTheme = localStorage.getItem('theme');
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const theme = savedTheme || (systemPrefersDark ? 'dark' : 'light');

                this.setTheme(theme, false);

                // Listen for theme toggle
                this.themeToggle.addEventListener('click', () => this.toggleTheme());

                // Listen for system theme changes
                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
                    if (!localStorage.getItem('theme')) {
                        this.setTheme(e.matches ? 'dark' : 'light', true);
                    }
                });
            }

            setTheme(theme, announce = false) {
                const icon = this.themeToggle.querySelector('span');
                if (theme === 'dark') {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    icon.textContent = 'â˜€ï¸';
                    this.themeToggle.setAttribute('aria-pressed', 'true');
                } else {
                    document.documentElement.removeAttribute('data-theme');
                    icon.textContent = 'ðŸŒ™';
                    this.themeToggle.setAttribute('aria-pressed', 'false');
                }

                // Update charts if they exist
                this.updateChartColors(theme);

                if (announce) {
                    this.announceThemeChange(theme);
                }
            }

            toggleTheme() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                this.setTheme(newTheme, true);
                localStorage.setItem('theme', newTheme);
            }

            announceThemeChange(theme) {
                const announcement = document.createElement('div');
                announcement.setAttribute('role', 'status');
                announcement.setAttribute('aria-live', 'polite');
                announcement.className = 'sr-only';
                announcement.textContent = `Theme changed to ${theme} mode`;
                document.body.appendChild(announcement);
                setTimeout(() => announcement.remove(), 1000);
            }

            updateChartColors(theme) {
                // Update Chart.js default colors based on theme
                if (typeof Chart !== 'undefined') {
                    const isDark = theme === 'dark';
                    Chart.defaults.color = isDark ? '#A1A1AA' : '#52525B';
                    Chart.defaults.borderColor = isDark ? '#27272A' : '#E4E4E7';

                    // Update existing charts
                    if (window.scenarioChart) {
                        window.scenarioChart.options.scales.x.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.scenarioChart.options.scales.y.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.scenarioChart.options.scales.x.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.scenarioChart.options.scales.y.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.scenarioChart.options.scales.x.grid.color = isDark ? '#27272A' : '#E4E4E7';
                        window.scenarioChart.options.scales.y.grid.color = isDark ? '#27272A' : '#E4E4E7';
                        window.scenarioChart.update();
                    }

                    if (window.vestingOptionsChart) {
                        window.vestingOptionsChart.options.scales.x.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.vestingOptionsChart.options.scales.y.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.vestingOptionsChart.options.scales.y1.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.vestingOptionsChart.options.scales.x.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.vestingOptionsChart.options.scales.y.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.vestingOptionsChart.options.scales.y1.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.vestingOptionsChart.options.scales.x.grid.color = isDark ? '#27272A' : '#E4E4E7';
                        window.vestingOptionsChart.options.scales.y.grid.color = isDark ? '#27272A' : '#E4E4E7';
                        window.vestingOptionsChart.update();
                    }

                    if (window.vestingValueChart) {
                        window.vestingValueChart.options.scales.x.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.vestingValueChart.options.scales.y.title.color = isDark ? '#FAFAFA' : '#18181B';
                        window.vestingValueChart.options.scales.x.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.vestingValueChart.options.scales.y.ticks.color = isDark ? '#A1A1AA' : '#52525B';
                        window.vestingValueChart.options.scales.x.grid.color = isDark ? '#27272A' : '#E4E4E7';
                        window.vestingValueChart.options.scales.y.grid.color = isDark ? '#27272A' : '#E4E4E7';
                        window.vestingValueChart.update();
                    }
                }
            }
        }

        // Initialize when DOM is ready
        let themeManager;

        document.addEventListener('DOMContentLoaded', function() {
            // Initialize theme manager
            themeManager = new ThemeManager();

            // Form submission
            document.getElementById('calculator-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateOptions();
            });

            // Set default grant date to today
            document.getElementById('grantDate').valueAsDate = new Date();

            // Vesting form submission
            document.getElementById('vesting-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateVestingTimeline();
            });

            // RSU form submission
            document.getElementById('rsu-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateRSU();
            });

            // Auto-calculate RSU on input change
            const rsuInputs = document.querySelectorAll('#rsu-tab input[type="number"]');
            rsuInputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (document.getElementById('rsu-results').classList.contains('show')) {
                        calculateRSU();
                    }
                });
            });

            // Auto-calculate on input change
            const inputs = document.querySelectorAll('#simple-tab input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('input', function() {
                    if (document.getElementById('results').classList.contains('show')) {
                        calculateOptions();
                    }
                });
            });

            // Keyboard navigation for tabs
            document.querySelectorAll('.tab').forEach((tab, index, tabs) => {
                tab.addEventListener('keydown', (e) => {
                    let newIndex;

                    if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        newIndex = (index + 1) % tabs.length;
                        tabs[newIndex].focus();
                    } else if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        newIndex = (index - 1 + tabs.length) % tabs.length;
                        tabs[newIndex].focus();
                    } else if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        tab.click();
                    }
                });
            });
        });

        function calculateOptions() {
            const numOptions = parseFloat(document.getElementById('numOptions').value);
            const strikePrice = parseFloat(document.getElementById('strikePrice').value);
            const currentPrice = parseFloat(document.getElementById('currentPrice').value);
            const vestedPercentage = parseFloat(document.getElementById('vestedPercentage').value);
            const taxRate = parseFloat(document.getElementById('taxRate').value);
            const minExitPrice = parseFloat(document.getElementById('minExitPrice').value);
            const maxExitPrice = parseFloat(document.getElementById('maxExitPrice').value);

            const gainPerOption = Math.max(0, currentPrice - strikePrice);
            const totalValue = gainPerOption * numOptions;

            const vestedOptions = Math.floor(numOptions * (vestedPercentage / 100));
            const unvestedOptions = numOptions - vestedOptions;
            const vestedValue = gainPerOption * vestedOptions;
            const afterTaxValue = vestedValue * (1 - taxRate / 100);

            document.getElementById('totalValue').textContent = formatCurrency(totalValue);
            document.getElementById('gainPerOption').textContent = formatCurrency(gainPerOption);
            document.getElementById('vestedOptions').textContent = vestedOptions.toLocaleString();
            document.getElementById('unvestedOptions').textContent = unvestedOptions.toLocaleString();
            document.getElementById('vestedValue').textContent = formatCurrency(vestedValue);
            document.getElementById('afterTaxValue').textContent = formatCurrency(afterTaxValue);

            document.getElementById('gainPerOption').className = 'result-value ' + (gainPerOption > 0 ? 'positive' : 'negative');

            // Clear old scenarios container (not used anymore)
            const scenariosContainer = document.getElementById('scenariosContainer');
            scenariosContainer.textContent = '';

            // Create scenario comparison chart
            createScenarioChart(minExitPrice, maxExitPrice, strikePrice, currentPrice, vestedOptions, taxRate);

            document.getElementById('results').classList.add('show');
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
        }

        // Scenario chart (global for theme updates)
        window.scenarioChart = null;

        function createScenarioChart(minExitPrice, maxExitPrice, strikePrice, currentPrice, vestedOptions, taxRate) {
            // Generate price range with reasonable intervals
            const priceRange = maxExitPrice - minExitPrice;
            const numberOfPoints = Math.min(20, Math.max(10, Math.ceil(priceRange / 5))); // 10-20 points
            const step = priceRange / (numberOfPoints - 1);

            const allPrices = [];
            for (let i = 0; i < numberOfPoints; i++) {
                allPrices.push(Math.round(minExitPrice + (step * i)));
            }

            // Make sure current price is highlighted if it's in range
            if (currentPrice >= minExitPrice && currentPrice <= maxExitPrice && !allPrices.includes(currentPrice)) {
                allPrices.push(currentPrice);
                allPrices.sort((a, b) => a - b);
            }

            const labels = allPrices.map(price => '$' + price.toFixed(0));
            const beforeTaxValues = allPrices.map(price => {
                const gain = Math.max(0, price - strikePrice);
                return gain * vestedOptions;
            });
            const afterTaxValues = beforeTaxValues.map(value => value * (1 - taxRate / 100));

            // Highlight current price
            const backgroundColors = allPrices.map(price =>
                price === currentPrice ? 'rgba(16, 185, 129, 0.9)' : 'rgba(16, 185, 129, 0.6)'
            );
            const afterTaxBackgroundColors = allPrices.map(price =>
                price === currentPrice ? 'rgba(118, 75, 162, 0.9)' : 'rgba(118, 75, 162, 0.6)'
            );

            const ctx = document.getElementById('scenarioChart').getContext('2d');

            if (window.scenarioChart) {
                window.scenarioChart.destroy();
            }

            window.scenarioChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Before-Tax Value',
                            data: beforeTaxValues,
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            borderColor: '#10b981',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        },
                        {
                            label: 'After-Tax Value',
                            data: afterTaxValues,
                            backgroundColor: 'rgba(118, 75, 162, 0.2)',
                            borderColor: '#764ba2',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 4,
                            pointHoverRadius: 6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const price = allPrices[context.dataIndex];
                                    let label = context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                    if (price === currentPrice) {
                                        label += ' (Current Price)';
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Value ($)',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Stock Price per Share',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });

            // Show the chart container
            document.getElementById('simple-chart-results').classList.add('show');
        }

        // Tab switching with keyboard navigation
        function switchTab(tabName, event) {
            // Update tab buttons
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.classList.remove('active');
                tab.setAttribute('aria-selected', 'false');
                tab.setAttribute('tabindex', '-1');
            });

            const activeTab = event ? event.target : document.getElementById(tabName + '-tab-btn');
            activeTab.classList.add('active');
            activeTab.setAttribute('aria-selected', 'true');
            activeTab.setAttribute('tabindex', '0');

            // Update tab content
            document.getElementById('simple-tab').classList.remove('active');
            document.getElementById('vesting-tab').classList.remove('active');
            document.getElementById('rsu-tab').classList.remove('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        // Vesting timeline calculator (global for theme updates)
        window.vestingOptionsChart = null;
        window.vestingValueChart = null;

        function calculateVestingTimeline() {
            const numOptions = parseFloat(document.getElementById('vestNumOptions').value);
            const strikePrice = parseFloat(document.getElementById('vestStrikePrice').value);
            const currentPrice = parseFloat(document.getElementById('vestCurrentPrice').value);
            const vestingPeriod = parseFloat(document.getElementById('vestingPeriod').value);
            const cliffPeriod = parseFloat(document.getElementById('cliffPeriod').value);
            const frequency = document.getElementById('vestingFrequency').value;
            const taxRate = parseFloat(document.getElementById('vestTaxRate').value);
            const grantDate = new Date(document.getElementById('grantDate').value);

            // Calculate vesting intervals in months
            const frequencyMonths = {
                'monthly': 1,
                'quarterly': 3,
                'semi-annually': 6,
                'annually': 12
            };

            const intervalMonths = frequencyMonths[frequency];
            const totalMonths = vestingPeriod * 12;
            const cliffMonths = cliffPeriod * 12;

            // Calculate vesting schedule
            const vestingSchedule = [];
            const labels = [];
            const vestedOptions = [];
            const vestedPercentages = [];
            const vestedValues = [];
            const afterTaxValues = [];

            let currentMonth = 0;
            let totalVested = 0;

            // Before cliff
            while (currentMonth < cliffMonths) {
                const date = new Date(grantDate);
                date.setMonth(date.getMonth() + currentMonth);
                labels.push(formatDate(date));
                vestedOptions.push(0);
                vestedPercentages.push(0);
                vestedValues.push(0);
                afterTaxValues.push(0);
                currentMonth += intervalMonths;
            }

            // At cliff
            if (cliffMonths > 0) {
                const cliffVest = Math.floor(numOptions * (cliffMonths / totalMonths));
                totalVested = cliffVest;
                const date = new Date(grantDate);
                date.setMonth(date.getMonth() + cliffMonths);
                labels.push(formatDate(date));
                vestedOptions.push(totalVested);
                vestedPercentages.push((totalVested / numOptions) * 100);
                const value = totalVested * Math.max(0, currentPrice - strikePrice);
                vestedValues.push(value);
                afterTaxValues.push(value * (1 - taxRate / 100));
                currentMonth = cliffMonths + intervalMonths;
            }

            // After cliff
            while (currentMonth <= totalMonths) {
                const vestPercentage = currentMonth / totalMonths;
                totalVested = Math.min(numOptions, Math.floor(numOptions * vestPercentage));

                const date = new Date(grantDate);
                date.setMonth(date.getMonth() + currentMonth);
                labels.push(formatDate(date));
                vestedOptions.push(totalVested);
                vestedPercentages.push((totalVested / numOptions) * 100);

                const value = totalVested * Math.max(0, currentPrice - strikePrice);
                vestedValues.push(value);
                afterTaxValues.push(value * (1 - taxRate / 100));

                currentMonth += intervalMonths;
            }

            // Create first chart - Vested Options
            const optionsCtx = document.getElementById('vestingOptionsChart').getContext('2d');

            if (window.vestingOptionsChart) {
                window.vestingOptionsChart.destroy();
            }

            window.vestingOptionsChart = new Chart(optionsCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Vested Options',
                            data: vestedOptions,
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const optionCount = vestedOptions[context.dataIndex];
                                    const percentage = vestedPercentages[context.dataIndex];
                                    return [
                                        optionCount.toLocaleString() + ' options vested',
                                        percentage.toFixed(1) + '% of total'
                                    ];
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Number of Options',
                                color: '#667eea',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            beginAtZero: true
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Percentage Vested',
                                color: '#10b981',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return value.toFixed(0) + '%';
                                },
                                color: '#10b981'
                            },
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                drawOnChartArea: false,
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });

            // Create second chart - Dollar Values
            const valueCtx = document.getElementById('vestingValueChart').getContext('2d');

            if (window.vestingValueChart) {
                window.vestingValueChart.destroy();
            }

            window.vestingValueChart = new Chart(valueCtx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Before-Tax Value',
                            data: vestedValues,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        },
                        {
                            label: 'After-Tax Value',
                            data: afterTaxValues,
                            borderColor: '#764ba2',
                            backgroundColor: 'rgba(118, 75, 162, 0.2)',
                            fill: true,
                            tension: 0.1,
                            borderWidth: 3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + formatCurrency(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            type: 'linear',
                            display: true,
                            title: {
                                display: true,
                                text: 'Value ($)',
                                color: '#10b981',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            },
                            ticks: {
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            beginAtZero: true
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                font: {
                                    weight: 'bold',
                                    size: 13
                                }
                            }
                        }
                    }
                }
            });

            document.getElementById('vesting-results').classList.add('show');
        }

        function formatDate(date) {
            const options = { year: 'numeric', month: 'short' };
            return date.toLocaleDateString('en-US', options);
        }

        // RSU Calculator
        function calculateRSU() {
            const numShares = parseFloat(document.getElementById('rsuNumShares').value);
            const grantPrice = parseFloat(document.getElementById('rsuGrantPrice').value);
            const currentPrice = parseFloat(document.getElementById('rsuCurrentPrice').value);
            const vestedPercentage = parseFloat(document.getElementById('rsuVestedPercentage').value);
            const taxRate = parseFloat(document.getElementById('rsuTaxRate').value);

            const totalValue = numShares * currentPrice;
            const vestedShares = Math.floor(numShares * (vestedPercentage / 100));
            const unvestedShares = numShares - vestedShares;
            const vestedValue = vestedShares * currentPrice;
            const afterTaxValue = vestedValue * (1 - taxRate / 100);
            const gainPerShare = currentPrice - grantPrice;
            const totalGain = vestedShares * gainPerShare;

            document.getElementById('rsuTotalShares').textContent = numShares.toLocaleString();
            document.getElementById('rsuTotalValue').textContent = formatCurrency(totalValue);
            document.getElementById('rsuVestedShares').textContent = vestedShares.toLocaleString();
            document.getElementById('rsuUnvestedShares').textContent = unvestedShares.toLocaleString();
            document.getElementById('rsuVestedValue').textContent = formatCurrency(vestedValue);
            document.getElementById('rsuAfterTaxValue').textContent = formatCurrency(afterTaxValue);
            document.getElementById('rsuGain').textContent = formatCurrency(totalGain);

            // Set positive/negative class on gain
            const gainElement = document.getElementById('rsuGain');
            gainElement.className = 'result-value ' + (totalGain >= 0 ? 'positive' : 'negative');

            document.getElementById('rsu-results').classList.add('show');
        }
    </script>
</body>
</html>
